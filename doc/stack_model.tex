\documentclass{article}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{../../Texts/macros}


\title{Linear Systems to Describe Interferogram Stacks}



\begin{document}
\maketitle

\section{Methods}
\subsection{Latent Linear Dynamical System Model }\label{sec:displacement_model}
\subsubsection{General Model Definition}
Consider the general time-discrete Latent Linear Dynamical System (LDS)\cite{Barber2011}:
\begin{equation}\label{eq:state_recursion}
	\begin{aligned}
		\mathbf{x}_t &= \mathbf{F}_t \mathbf{x}_{t-1} + \mathbf{C} \mathbf{u}_t + \mathbf{w}_t \quad \mathbf{w}_t \sim \normdist{0}{\mathbf{Q_t}} \\
		\mathbf{y}_{t} &= \mathbf{H}_{t}  \mathbf{x}_{t} +  \mathbf{D} \mathbf{u}_t + \mathbf{v}_t \quad \mathbf{v}_t   \sim \normdist{0}{\mathbf{R}_t}
	\end{aligned}
\end{equation}
that describes the evolution of the hidden state $\mathbf{x_t}$ of a stochastic linear dynamical system, of which we observe $\mathbf{y}_t$, a transformed version of the hidden state corrupted by zero mean additive Gaussian noise with covariance matrix $\mathbf{R}_t$. Additionally, the system can be influenced by an external input $u_{t}$ through the matrices $\mathbf{C}$ and $\mathbf{D}$. \\
For example, for an uniform linear motion the state vector $\mathbf{x}_t$ would consist of position and velocity at each time $t$:
\begin{equation}\label{eq:simplified_state}
\mathbf{x}_t = 
	\begin{bmatrix}
		d_{t}\\
		v_{t}
	\end{bmatrix}
\end{equation}
where $d_t$ is the distance from the point to a (non-moving) reference point and $v_t$ is the velocity of the motion. $\mathbf{F}_t$ describes the evolution of the parameters from $t$ to $t+1$. In the case of an uniform motion, $\mathbf{F}_t$ would be: 
\begin{equation}\label{eq:simplified_F}
	\mathbf{x}_t = 
		\begin{bmatrix}
			d_{t}\\
			v_{t}
		\end{bmatrix} =
		\begin{bmatrix}
		1 & \Delta t\\
		0 & 1
		\end{bmatrix}
		\begin{bmatrix}
			d_{t-1}\\
			v_{t-1}
		\end{bmatrix}.
\end{equation}
Where $\Delta t$ is the duration of the time step between $t-1$ and $t$.\\
\subsubsection{Modeling a Single Interferogram}
The Latent LDS will be used as a simplified model to describe terrain deformation as observed by differential radar interferometry. The latent state $\mathbf{x}_t$ is assumed to contain the line-of-sight velocity and displacement w.r.t  the reference point for any feature of interest on the terrain, represented in the radar geometry.\\ Assuming an uniform linear model, the state transition is described by the $\mathbf{F}$ matrix of~\autoref{eq:simplified_F}. For the moment, no assumptions are made regarding the covariance matrix $\mathbf{Q}_t$.\\
Under this very simplistic model, the SLC phase $\phi_t$ at each pixel at time $t$ is proportional to $r_t$, the distance between the pixel and the sensor modulo $2 \pi$:
\begin{equation}
	\phi_t = \frac{4\pi}{\lambda} r_t + 2 \pi n.
\end{equation}
Using the distance between radar and reference point, $r_t^{ref}$, $r_t$ can be rewritten as a function of the relative displacement as described by the LDS, $d_t$:
\begin{equation}
	r_t = r_t^{ref} + d_t.
\end{equation}
Thus, the SLC phase can be expressed as:
\begin{equation}
	\begin{aligned}
	\phi_t  &= \frac{4\pi}{\lambda} \left(
		\begin{bmatrix}
			1 & 0
		\end{bmatrix} \mathbf{x}_{t}
		+  r_t^{ref}
		\right) + 2 \pi n\\
		 &= \left(\mathbf{H}_{t}\mathbf{x}_t + \mathbf{D}\mathbf{u}_t\right) + 2 \pi n
	\end{aligned}		
\end{equation}
That can be identified as an output $\mathbf{y}_t$ of the LDS with :
\begin{equation}\label{eq:slc_phase_output}
	\begin{aligned}
		\mathbf{H}_{t} &=		
						\begin{bmatrix}
							\frac{4\pi}{\lambda} & 0
						\end{bmatrix}\\
		\mathbf{u}_t &= r_{t}^{ref}\\
		\mathbf{D}_t &=\frac{4\pi}{\lambda}\\
	\end{aligned}
\end{equation}	
modulo $2\pi$.\\
Usually, instead of considering the SLC phase, interferograms are formed between acquisitions at different times $t_i$ and $t_j$. By doing so, all systematic effects are removed; theoretically the interferograms phase $\Delta\phi_{t_i,t_j}$ is proportional to the change in distance from the point to the radar between acquisition $t_i$ and $t_j$ modulo $2\pi$:
\begin{equation}
	\Delta\phi_{t_i,t_j} =  \mathbf{y}_{t_{i}} - \mathbf{y}_{t_{j}}
\end{equation}
Assuming the reference point to be stable, i.e $\mathbf{u}_{t_i} = \mathbf{u}_{t_j}$, the interferogram phase simplifies to a function of the hidden states only:
\begin{equation}\label{ifgram_phase}
	\Delta\phi_{t_i,t_j} = \mathbf{H} \left( \mathbf{x}_{t_i} - \mathbf{x}_{t_j} \right) +2 n \pi.
\end{equation}		
Where the index $t$ in $\mathbf{H}$ has been dropped, because the output matrix does not change over time.
Naively assuming that no phase wrapping occurs between $t_{i}$ and $t_{j}$ or that it is successfully resolved by a phase unwrapping algorithm, the $2\pi n$ terms can be removed as well, simplifying the subsequent derivations.
Using~\autoref{eq:state_recursion} the state $\mathbf{x}_{t_j}$ can be expressed recursively as a function of the previous states, arriving at an expression that depends on $\mathbf{x}_{t_i}$ only:
\begin{equation}\label{eq:state_recursion_explicit}
	\mathbf{x}_{t_j} = \prod_{t=t_{i}}^{t_j}\mathbf{F}_t \mathbf{x}_{t_i}.
\end{equation}
The interferometric phase can be then rewritten as:
\begin{equation}\label{eq:single_ifgram}
	\Delta\phi_{t_i,t_j} = \mathbf{H} \left(\mathbf{I} - \prod_{t=t_{i}}^{t_j}\mathbf{F}_t \right)\mathbf{x}_{t_i}
\end{equation}	
where $\mathbf{H} = 
	\begin{bmatrix}
	 \frac{4\pi}{\lambda} & 0
	\end{bmatrix}$.
\subsection{Modeling an Interferogram Stack}
Generally, it is desired to analyze a \emph{stack} $\Delta\mathbf{\Phi}_{i}$  of interferograms, that is a subset of length $N_{stack}$ interferograms computed from a sequence of $N_{slc}$ SLC phases starting from time $t_{i-N_{slc}}$ up to time $t_{i}$ arranged in an SLC vector $\mathbf{\Phi}_{t_i}$:
\begin{equation}
	\mathbf{\Phi}_{t_i} = 		\begin{bmatrix}
									\mathbf{y}_{t_{i}}\\
									\vdots\\
									\mathbf{y}_{t_{i-N_{slc}}}\\
								\end{bmatrix}.
\end{equation}
Or using~\autoref{eq:slc_phase_output} :
\begin{equation}
	\mathbf{\Phi}_{t_i} = 		\begin{bmatrix}
									\mathbf{H}\mathbf{x}_{t_{i}} + \mathbf{D}\mathbf{u}_{t}\\
									\vdots\\
									\mathbf{H}\mathbf{x}_{t_{i-N_{slc}}} + \mathbf{D}\mathbf{u}_{t_{i-N_{slc}}}\\
								\end{bmatrix}.
\end{equation}
This expression can be vectorized as:
\begin{equation}
	\mathbf{\Phi}_{t_i} = \hat{\mathbf{H}} \hat{\mathbf{x}}_{t_i} + \hat{\mathbf{D}} \hat{\mathbf{u}}_{t_i},
\end{equation}
where $\hat{\mathbf{H}}$ respectively $\hat{\mathbf{D}}$ are block diagonal matrices with $\mathbf{H}$ and $\mathbf{D}$ on the main diagonal and $\hat{\mathbf{x}}_{t_i}$ is the augmented state vector containing all states from $t_{i-N_{slc}}$ to $t_{i}$.
Using the state recursion equation, $\hat{\mathbf{x}}_{t_i}$ can be written as a function of the previous augmented state.
The interferograms  are obtained from the SLC vector using the  $N_{stack}\times N_{slc}$ incidence matrix $\mathbf{A}$, with $A_{m,k} = 1, A_{m,l}=-1$ for the m-th interferogram in the stack obtained from SLCs $k$ and $l$\cite{Agram2015}:
\begin{equation}
	 \Delta\mathbf{\Phi}_{i} = \mathbf{A} \mathbf{\Phi}_{i}.
\end{equation}
Using the state recursion and the output matrix, the vector of SLC phases can be expressed as a function of the state at time $t_{i-N_{slc}}$ in analogy to~\autoref{eq:state_recursion_explicit}:

\section{Single Reference Stack}
If an interferogram is formed between the $i-th$ and the $i + 1-th$ SLC, the interferogram phase $\Delta\phi_{i}$ can be expressed as a function of the model output $\phi_i$:
\begin{equation}
	\Delta\phi_{i,i+1} = \phi_{i} - \phi_{i + 1}.
\end{equation} 
Using the linear model of~\autoref{sec:displacement_model}, the interferometric phase difference can be expressed as a function of the model state $\mathbf{x}$ at times $i$ and $i+1$ as:
\begin{equation}
	\Delta\phi_{i,i+1} = \mathbf{H} \left(\mathbf{x}_i - \mathbf{x}_{i+1}\right),
\end{equation}
or 
\begin{equation}
	\Delta\phi_{i,i+1} = \mathbf{H} \left(\mathbf{x}_i - \mathbf{F}_{i+1}\mathbf{x}_i\right).
\end{equation}
or in a more compact form:
\begin{equation}\label{eq:output_step_1}
	\Delta\phi_{i,i+1} =  \mathbf{H} \left(\mathbf{I} - \mathbf{F}_{i+1} \right) \mathbf{x_i}.
\end{equation}
Notice that the matrix $\mathbf{F}$ depends on the index $i$; this allows to model for variable timesteps, where $\Delta t$ is not constant over the span of all acquisitions.
Consequently,
\begin{equation}\label{eq:output_step_2}
	\Delta\phi_{i,i+2} =  \mathbf{H} \left(\mathbf{I} - \mathbf{F}_{i+2}\mathbf{F}_{i+1} \right) \mathbf{x_i}.
\end{equation}
By induction we then have that the interferogram between the $i-th$ and the $i+n-th$ SLC can be expressed as:
\begin{equation}
	\Delta\phi_{i,i+n} =  \mathbf{H} \left(\mathbf{I} - \prod_{k=i+n}^{i}\mathbf{F}_k\right) \mathbf{x_i}.
\end{equation}
Thus, a stack  $\Delta\mathbf{\Phi_{i}}$ of interferograms of length $N_{stack}$ referenced to acquisition $i$ can be modeled from the state variable at time $i$ $\mathbf{x_{i}}$ as:
\begin{equation}
	\Delta\mathbf{\Phi_{i}} =\begin{bmatrix}
	 	\mathbf{H} \left(\mathbf{I} - \mathbf{F}_i\right)\\
	 	\vdots\\
	 	\mathbf{H} \left(\mathbf{I} - \prod_{k=i+n}^{i}\mathbf{F}_k\right)\\
	 	\vdots\\
	 	\mathbf{H} \left(\mathbf{I} -\prod_{k=i+N_{stack}}^{i}\mathbf{F}_k\right)
	\end{bmatrix}\mathbf{x_i} = \mathbf{H}^{stack} \mathbf{x_i}
\end{equation}
\section{Multi Reference Stack}
A similar model can be used for a multi-reference stack, where we consider a subset of length $N_{stack}$ interferograms  computed from all unique combinations of $N_{slc}$ SLCs. Ordering the interferograms lexicographically by the times of the master and slave acquisitions, the stack for all possible unique combinations is expressed as:
\begin{equation}\label{eq:stack}
	\begin{aligned}
			 \Delta\mathbf{\Phi_{i}} =
		\begin{bmatrix}
			\phi_{i} - \phi_{i+1}\\
			\phi_{i+1} - \phi_{i+2}\\
			\vdots\\
			\phi_{i+j} - \phi_{i+l}\\
			\vdots\\
			\phi_{i+N_{stack}} - \phi_{i+N_{stack} - 1}
		\end{bmatrix}\\
		\forall j,l : j < l < N_{stack}.
		\end{aligned}
\end{equation}
This can be expressed as a matrix-vector multiplication:
\begin{equation}
	 \Delta\mathbf{\Phi_{i}} = \mathbf{A} \mathbf{\Phi_{i}}.
\end{equation}
where $\mathbf{\Phi_{i}}$ is the vector of SLC phases and $\mathbf{A}$ is the $N_{stack}\times N_{slc}$ incidence matrix of interferograms, with $A_{m,j} = 1, A_{m,l}=-1$ for the m-th interferogram in the stack\cite{Agram2015}.\\
Considering again the linear model of~\autoref{sec:displacement_model}, the SLC vector  $\mathbf{\Phi_{i}}$ can be expressed from $\mathbf{x_i}$:
\begin{equation}
	 \mathbf{\Phi_{i}} = 
	 \begin{bmatrix}
	 	\mathbf{H}\\
	 	\vdots\\
	 	\mathbf{H} \prod_{k=i+j}^{i}\mathbf{F}_k\\
	 	\vdots\\
	 	\mathbf{H} \prod_{k=i+N_{slc}}^{i}\mathbf{F}_k
	 \end{bmatrix} \mathbf{x_i}.
\end{equation}
from this, the stack $\Delta\mathbf{\Phi_{i}}$ is expressed as:
\begin{equation}\label{eq:stack_output}
	\Delta\mathbf{\Phi_{i}} = \mathbf{A} 
			 \begin{bmatrix}
			 	\mathbf{H}\\
			 	\vdots\\
			 	\mathbf{H} \prod_{k=i+j}^{i}\mathbf{F}_k\\
			 	\vdots\\
			 	\mathbf{H} \prod_{k=i+N_{slc}}^{i}\mathbf{F}_k
			 \end{bmatrix}\mathbf{x_i} = \mathbf{\Pi} \mathbf{x_i},
\end{equation}
where $i$ is the index of the stack; representing a sort of "sliding window" of length $N_{stack}$ that is run over the slcs as the time runs.
Thus, the stack at time $i$ can be considered the output of a linear system where the dynamics are described by the matrix $\mathbf{F}_i$ with $\Delta t$ the time interval between the first and the last SLC in the stack, while the output is given by the matrix $\mathbf{\Pi}$
\section{Kalman Filter for Stacking}
The Kalman filter can be used to obtain posterior estimates of the displacement model parameters given  observed interferogram stacks. The following steps are run recursively, whenever new SLC data is available:
\begin{itemize}
	\item Predict: the prior state estimate at time $i$ i, $\state{\mathbf{\hat{x}}}{i}{i-1}$ is computed by propagating the  previous posterior state estimate $\state{\mathbf{\hat{x}}}{i-1}{i-1}$ with the model equation:
	\begin{align}\label{eq:prediction}
		&\state{\mathbf{\hat{x}}}{i}{i-1} = \mathbf{F} \state{\mathbf{\hat{x}}}{i-1}{i-1}\\
		&\state{\mathbf{P}}{k}{k-1} = \mathbf{F} \state{\mathbf{P}}{k-1}{k-1} \mathbf{F}^\mathsf{T} + \mathbf{Q}_{k}
	\end{align}
	\item Update: when a new SLC is available, the stack index $i$ is advanced by one and the new stack is computed according to~\autoref{eq:stack}. In Kalman filter terminology, the stack $\Delta\mathbf{\Phi_i} $corresponds to the observation. Using the computed stack and the measurement equation of~\autoref{eq:stack_observation}, the measurement residual  between the data and the predicted stack from the prior state is calculated:
	\begin{equation}
		\tilde{\mathbf{y}}_i = \Delta\mathbf{\Phi_i} - \mathbf{\Pi} \state{\mathbf{\hat{x}}}{i}{i-1}
	\end{equation}
	The residual covariance is estimated using the prior covariance of~\autoref{eq:prediction}  and the measurement of~\autoref{eq:stack_output}:
	\begin{equation}
		\mathbf{S}_i = \mathbf{\Pi} \state{\mathbf{P}}{i}{i-1}{\mathbf{\Pi}}^\mathsf{T}
	\end{equation}
	Using the residual, the Kalman gain matrix is determined:
	\begin{equation}
		\mathbf{K}_i = \state{\mathbf{P}}{i}{i-1}{\mathbf{\Pi}}^\mathsf{T}\mathbf{S}_i^{-1}
	\end{equation}
	The optimal gain weights the  combination between the prior state determined in the prediction step and the observation to produce the posterior state estimate, so that 
	a noisier observation is given less weight and vice versa:
	\begin{equation}
		\state{\mathbf{\hat{x}}}{i}{i} = \state{\mathbf{\hat{x}}}{i}{i} + \mathbf{K}_i \tilde{\mathbf{y}}_i.
	\end{equation}
	The update of the covariance determines the posterior covariance of the state estimate $\state{\mathbf{\hat{x}}}{i}{i}$ using the Kalman gain and the prior covariance obtained in the the prediction step:
	\begin{equation}
	\state{\mathbf{P}}{i}{i} = \left(\mathbf{I} - \mathbf{K}_i\mathbf{\Pi}\right)\state{\mathbf{P}}{i}{i-1}
	\end{equation}
\end{itemize}
With this method, a new SLC image can be used to estimate updated displacement model parameter "online" using the previously estimated parameters and the stack formed with~\autoref{eq:stack}.
\section{Correlation Model}
\bibliographystyle{ieeetr}
\bibliography{../../Texts/library}
\end{document}